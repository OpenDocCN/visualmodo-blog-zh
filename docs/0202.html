<html>
<head>
<title>HTTPS SSL: Migration Guide</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">HTTPS SSL:迁移指南</h1>
<blockquote>原文：<a href="https://medium.com/visualmodo/https-ssl-migration-guide-df6a2cc247fb?source=collection_archive---------0-----------------------#2018-04-29">https://medium.com/visualmodo/https-ssl-migration-guide-df6a2cc247fb?source=collection_archive---------0-----------------------#2018-04-29</a></blockquote><div><div class="ef hi hj hk hl hm"/><div class="hn ho hp hq hr"><div class=""/><p id="9083" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">HTTPS提供了三层关键的保护。加密。加密交换的数据以保证其安全。数据完整性。数据在传输过程中无法被修改或破坏而不被检测到。身份验证证明您的用户与目标网站进行了通信。</p><h1 id="22fd" class="jp jq hu bd jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km dt translated">HTTPS — SSL迁移指南</h1><figure class="ko kp kq kr fq ks fe ff paragraph-image"><div role="button" tabindex="0" class="kt ku di kv bf kw"><div class="fe ff kn"><img src="../Images/f8151c069541347478598d3b3909291f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*IghdwcliVy-M5RYA.jpg"/></div></div></figure><h1 id="7634" class="jp jq hu bd jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km dt translated">一点背景故事</h1><p id="ac99" class="pw-post-body-paragraph ir is hu it b iu kz iw ix iy la ja jb jc lb je jf jg lc ji jj jk ld jm jn jo hn dt translated">回到2014年，在<a class="ae le" href="http://heartbleed.com/" rel="noopener ugc nofollow" target="_blank">心脏出血错误</a>公之于众后，HTTPS成为热门话题。这个bug允许怀有恶意的人监听通过SSL/TLS传输的流量。这也给了他们劫持和/或读取数据的能力。幸运的是，这个漏洞在被发现后很快得到了修补。这一事件敲响了警钟，正确加密互联网上的用户信息是必要的，而不应该是可有可无的事情。</p><p id="62ca" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">为了强调加密敏感数据的重要性，每当你访问一个不加密潜在敏感数据(如表单)的网站时，谷歌Chrome(自2017年1月起)都会在地址栏旁边显示一条明确的警告。</p><h1 id="94c7" class="jp jq hu bd jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km dt translated">我如何切换？</h1><p id="c6a4" class="pw-post-body-paragraph ir is hu it b iu kz iw ix iy la ja jb jc lb je jf jg lc ji jj jk ld jm jn jo hn dt translated">因为您的数据安全非常重要，所以我们在2014年采取措施确保我们自己的网站都有SSL证书。如果你决定转行(你真的应该！)，有几件事你需要考虑到，以确保你的网站完全按照预期工作，一旦你完成。</p><ul class=""><li id="28eb" class="lf lg hu it b iu iv iy iz jc lh jg li jk lj jo lk ll lm ln dt translated">你需要改变你所有的内部链接。这也意味着更新资产的链接(如果需要的话)。确保浏览你的主题，修改对CSS、图片和JavaScript文件的引用。此外，您可以将所有的链接改为以<code class="eh lo lp lq lr b">//</code>开头，而不是以<code class="eh lo lp lq lr b">https://</code>开头，这将产生与协议相关的URL。</li><li id="fb92" class="lf lg hu it b iu ls iy lt jc lu jg lv jk lw jo lk ll lm ln dt translated">确保你的CDN也支持SSL。我们使用MaxCDN，它允许您在您的CDN子域上轻松设置SSL。</li><li id="a11e" class="lf lg hu it b iu ls iy lt jc lu jg lv jk lw jo lk ll lm ln dt translated">有各种级别的SSL可供选择，每种级别都有各自的优缺点。稍后你会找到更多的相关信息。</li><li id="4571" class="lf lg hu it b iu ls iy lt jc lu jg lv jk lw jo lk ll lm ln dt translated">确保你的网站的<code class="eh lo lp lq lr b">&lt;head&gt;</code>部分有一个规范的链接，可以正确地将所有来自<code class="eh lo lp lq lr b"><a class="ae le" href="http://to.https://" rel="noopener ugc nofollow" target="_blank">http://</a></code> <a class="ae le" href="http://to.https://" rel="noopener ugc nofollow" target="_blank">的流量重定向到。</a> <code class="eh lo lp lq lr b"><a class="ae le" href="http://to.https://" rel="noopener ugc nofollow" target="_blank">https://</a></code></li></ul><p id="78eb" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">谷歌还发布了一份方便的指南，告诉你如何在不严重影响排名的情况下搬到HTTPS，你可以在这里找到。</p><h1 id="b3d1" class="jp jq hu bd jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km dt translated">这对我的排名有什么影响？</h1><figure class="ko kp kq kr fq ks fe ff paragraph-image"><div role="button" tabindex="0" class="kt ku di kv bf kw"><div class="fe ff kn"><img src="../Images/41af29963b614d403bd971e5d1701c7a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*2jxJTlq5hZVvmwd_.png"/></div></div></figure><p id="2ab8" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">就像前面提到的，如果你没有相应的计划，从HTTP迁移到HTTPS会稍微影响你的排名。然而，当你转到HTTPS后，你的排名会随着时间的推移而提高。谷歌<a class="ae le" href="https://webmasters.googleblog.com/2014/08/https-as-ranking-signal.html" rel="noopener ugc nofollow" target="_blank">在2014年</a>宣布，拥有SSL证书将被视为一个积极的排名因素，因此值得投资。</p><p id="58e8" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">为了确保谷歌机器人可以在迁移后更快地重新索引你的<a class="ae le" href="https://visualmodo.com/" rel="noopener ugc nofollow" target="_blank">网站</a>，确保你在<code class="eh lo lp lq lr b">https://</code>低流量时段迁移到。这样，Googlebot可以使用更多的服务器资源。只是考虑到一个中等规模的网站可能需要一段时间来恢复排名。有网站地图吗？那么Googlebot可能会更快地重新计算和索引你的网站。</p><h1 id="8b91" class="jp jq hu bd jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km dt translated">在服务器上设置HTTPS和SSL</h1><p id="57cc" class="pw-post-body-paragraph ir is hu it b iu kz iw ix iy la ja jb jc lb je jf jg lc ji jj jk ld jm jn jo hn dt translated">一般来说，主机提供商有一项服务，允许您启用HTTPS/订购证书。有几种类型的证书可供选择，它们在几个方面有所不同。每种型号都有自己的价格标签，所以在购买之前，请确保您的证书符合您的需求和预算！</p><p id="8d9f" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">如果你手头有点紧，也不太懂技术，那就去看看<a class="ae le" href="https://letsencrypt.org/" rel="noopener ugc nofollow" target="_blank">让我们加密</a>获得一个免费的(！)证书。</p><p id="4072" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">如果您运行并管理自己的web服务器，在能够使用SSL证书之前，您必须在服务器配置中启用一些东西。<a class="ae le" href="https://www.digitalocean.com/community/tutorials/how-to-install-an-ssl-certificate-from-a-commercial-certificate-authority" rel="noopener ugc nofollow" target="_blank">本教程</a>解释了在你的服务器上运行证书的步骤。</p><h1 id="e615" class="jp jq hu bd jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km dt translated">OCSP装订</h1><p id="3f4e" class="pw-post-body-paragraph ir is hu it b iu kz iw ix iy la ja jb jc lb je jf jg lc ji jj jk ld jm jn jo hn dt translated">必须检查SSL证书的有效性可能会导致加载速度稍有下降。要克服这一点，您可以使用<a class="ae le" href="https://en.wikipedia.org/wiki/OCSP_stapling" rel="noopener ugc nofollow" target="_blank"> OCSP装订</a>。OCSP装订是一项功能，它使服务器能够在检查SSL证书时下载证书供应商响应的副本。这意味着，一旦浏览器连接到服务器，它将根据服务器上的副本检查证书的有效性，而不必询问证书供应商本身，从而显著提高性能。</p><h1 id="5408" class="jp jq hu bd jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km dt translated">街头流氓</h1><p id="5c96" class="pw-post-body-paragraph ir is hu it b iu kz iw ix iy la ja jb jc lb je jf jg lc ji jj jk ld jm jn jo hn dt translated">在您的Apache服务器上启用OCSP装订之前，请通过在您的服务器上运行命令<code class="eh lo lp lq lr b">apache2 -v</code>(或<code class="eh lo lp lq lr b">httpd -v</code>)来检查您运行的是Apache的2.3.3+版本。<strong class="it hv">较低版本的Apache不支持此功能</strong>。</p><p id="142a" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">如果您按照“在您的服务器上设置HTTPS和SSL”一节中的描述完成了在您的服务器上设置HTTPS的过程，那么您应该已经接触过专门为HTTPS/SSL使用而设计的虚拟主机配置。</p><p id="c821" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">在该文件中，采取以下步骤:</p><ol class=""><li id="5088" class="lf lg hu it b iu iv iy iz jc lh jg li jk lj jo lx ll lm ln dt translated">在<code class="eh lo lp lq lr b">&lt;VirtualHost&gt;&lt;/VirtualHost&gt;</code>部分，你应该加上。<code class="eh lo lp lq lr b">SSLUseStapling on</code></li><li id="5221" class="lf lg hu it b iu ls iy lt jc lu jg lv jk lw jo lx ll lm ln dt translated">在<code class="eh lo lp lq lr b">&lt;VirtualHost&gt;&lt;/VirtualHost&gt;</code>部分的正上方，添加<code class="eh lo lp lq lr b">SSLStaplingCache shmcb:/tmp/stapling_cache(128000)</code></li><li id="bac4" class="lf lg hu it b iu ls iy lt jc lu jg lv jk lw jo lx ll lm ln dt translated">通过运行检查配置是否仍然有效。<code class="eh lo lp lq lr b">apachectl -t</code>如果是这样，通过运行。<code class="eh lo lp lq lr b">service apache2 reload</code></li></ol><h1 id="fdb8" class="jp jq hu bd jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km dt translated">Nginx</h1><p id="ec1b" class="pw-post-body-paragraph ir is hu it b iu kz iw ix iy la ja jb jc lb je jf jg lc ji jj jk ld jm jn jo hn dt translated">Nginx还支持OCSP装订。在编辑服务器配置之前，请通过在<code class="eh lo lp lq lr b">nginx -v</code>服务器上运行命令来检查您运行的是Nginx 1 . 3 . 7+版本。<strong class="it hv">Nginx的较低版本不支持此功能</strong>。</p><p id="0b93" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">如果你按照“在你的服务器上设置HTTPS和SSL”一节中所描述的在你的服务器上设置HTTPS的过程，那么你应该已经接触过专门为HTTPS/SSL使用而设计的Nginx配置。</p><p id="8072" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">在该文件中，在<code class="eh lo lp lq lr b">server {}</code>部分添加以下行:</p><pre class="ko kp kq kr fq ly lr lz ma aw mb dt"><span id="3c77" class="mc jq hu lr b fv md me l mf mg">ssl_stapling on;<br/>ssl_stapling_verify on;<br/>ssl_trusted_certificate /etc/ssl/private/ca-certs.pem;</span></pre><p id="0176" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">最后一行引用了一个包含可信CA证书列表的文件。该文件用于在使用OCSP时验证客户端证书。</p><p id="ab20" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">将这些行添加到文件后，通过运行以下命令检查配置是否仍然有效。<code class="eh lo lp lq lr b">service nginx configtest</code>如果是这样，通过运行。<code class="eh lo lp lq lr b">service nginx reload</code></p></div><div class="ab cl mh mi hb mj" role="separator"><span class="mk bw bk ml mm mn"/><span class="mk bw bk ml mm mn"/><span class="mk bw bk ml mm"/></div><div class="hn ho hp hq hr"><h1 id="798c" class="jp jq hu bd jr js mo ju jv jw mp jy jz ka mq kc kd ke mr kg kh ki ms kk kl km dt translated">严格传输安全标头</h1><figure class="ko kp kq kr fq ks fe ff paragraph-image"><div role="button" tabindex="0" class="kt ku di kv bf kw"><div class="fe ff kn"><img src="../Images/6bb6ac702e02c7451512cd35948993f9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*Y_FW094Y6-pI5vrW.png"/></div></div></figure><p id="4849" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">严格的传输安全头(HSTS)是另一个方便的特性，它基本上强制浏览器使用HTTPS请求，而不是HTTP请求。启用这个特性相对来说比较容易。</p><h1 id="c147" class="jp jq hu bd jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km dt translated">街头流氓</h1><p id="31e4" class="pw-post-body-paragraph ir is hu it b iu kz iw ix iy la ja jb jc lb je jf jg lc ji jj jk ld jm jn jo hn dt translated">如果您正在运行Apache，首先通过运行以下命令启用Apache Headers模块。<code class="eh lo lp lq lr b">a2enmod headers</code>在此之后，只需将以下代码行添加到您之前为<a class="ae le" href="https://visualmodo.com/" rel="noopener ugc nofollow" target="_blank"> HTTPS </a>设置的虚拟主机配置(在<code class="eh lo lp lq lr b">&lt;VirtualHost&gt;&lt;/VirtualHost&gt;</code>部分)中:</p><pre class="ko kp kq kr fq ly lr lz ma aw mb dt"><span id="f455" class="mc jq hu lr b fv md me l mf mg">Header always set Strict-Transport-Security "max-age=31536000; includeSubDomains"</span></pre><p id="432a" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">重新加载Apache服务，您就可以开始了！</p><h1 id="0b74" class="jp jq hu bd jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km dt translated">Nginx</h1><p id="4816" class="pw-post-body-paragraph ir is hu it b iu kz iw ix iy la ja jb jc lb je jf jg lc ji jj jk ld jm jn jo hn dt translated">Nginx要求您在服务器配置文件的<code class="eh lo lp lq lr b">server{}</code>部分添加下面一行:</p><pre class="ko kp kq kr fq ly lr lz ma aw mb dt"><span id="b13d" class="mc jq hu lr b fv md me l mf mg">add_header Strict-Transport-Security max-age=31536000;</span></pre><h1 id="d160" class="jp jq hu bd jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km dt translated">测试</h1><p id="002e" class="pw-post-body-paragraph ir is hu it b iu kz iw ix iy la ja jb jc lb je jf jg lc ji jj jk ld jm jn jo hn dt translated">要查看你的SSL证书是否正常工作，去<a class="ae le" href="https://www.ssllabs.com/ssltest/" rel="noopener ugc nofollow" target="_blank"> SSL实验室</a>，填写你的域名，看看你得到了什么样的分数。</p><h1 id="9e85" class="jp jq hu bd jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km dt translated">重定向URL</h1><p id="0e96" class="pw-post-body-paragraph ir is hu it b iu kz iw ix iy la ja jb jc lb je jf jg lc ji jj jk ld jm jn jo hn dt translated">为了确保请求被正确地重定向到HTTPS URL，您需要在您的配置中增加一行。这样，试图通过HTTP访问您的网站的流量将自动重定向到HTTPS。</p><h1 id="fd7b" class="jp jq hu bd jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km dt translated">街头流氓</h1><p id="3b76" class="pw-post-body-paragraph ir is hu it b iu kz iw ix iy la ja jb jc lb je jf jg lc ji jj jk ld jm jn jo hn dt translated">在默认的VirtualHost配置(用于HTTP请求的配置)中，添加以下内容以确保URL被正确重定向:</p><pre class="ko kp kq kr fq ly lr lz ma aw mb dt"><span id="8e0a" class="mc jq hu lr b fv md me l mf mg">RewriteEngine On<br/>RewriteCond %{HTTPS} off<br/>RewriteRule (.*) https://%{HTTP_HOST}%{REQUEST_URI} [R=301,L]</span></pre><p id="79ea" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">和我们之前做的其他<a class="ae le" href="https://visualmodo.com/" rel="noopener ugc nofollow" target="_blank">改动</a>一样，别忘了重新加载Apache！</p><h1 id="6903" class="jp jq hu bd jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km dt translated">Nginx</h1><p id="61f9" class="pw-post-body-paragraph ir is hu it b iu kz iw ix iy la ja jb jc lb je jf jg lc ji jj jk ld jm jn jo hn dt translated">在Nginx中，更改用于HTTP请求的默认配置文件，如下所示:</p><pre class="ko kp kq kr fq ly lr lz ma aw mb dt"><span id="23ab" class="mc jq hu lr b fv md me l mf mg">server {<br/>    listen 80;<br/>    server_name your-site.com www.your-site.com;<br/>    return 301 https://your-site.com$request_uri;<br/>}</span></pre><p id="99b9" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">在测试这些更改之前，不要忘记重新加载Nginx。</p><h1 id="43f1" class="jp jq hu bd jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km dt translated">结论</h1><p id="e268" class="pw-post-body-paragraph ir is hu it b iu kz iw ix iy la ja jb jc lb je jf jg lc ji jj jk ld jm jn jo hn dt translated">"我应该转到HTTPS吗？"简而言之:是的。使用<a class="ae le" href="https://visualmodo.com/" rel="noopener ugc nofollow" target="_blank"> HTTPS </a>确保私人(用户)信息以更安全的方式在网络上传送。尤其是如果你处理货币交易，HTTPS是必须的。</p><p id="5aa5" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">您最终选择哪种类型的证书，取决于您的具体使用情况和预算。确保事先适当研究你的选择。</p></div></div>    
</body>
</html>