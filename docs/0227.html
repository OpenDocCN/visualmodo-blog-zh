<html>
<head>
<title>HTTP 503 Service Unavailable Handling</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">HTTP 503服务不可用处理</h1>
<blockquote>原文：<a href="https://medium.com/visualmodo/http-503-service-unavailable-handling-12756c574b38?source=collection_archive---------0-----------------------#2018-05-24">https://medium.com/visualmodo/http-503-service-unavailable-handling-12756c574b38?source=collection_archive---------0-----------------------#2018-05-24</a></blockquote><div><div class="ef hi hj hk hl hm"/><div class="hn ho hp hq hr"><div class=""/><p id="513d" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">超文本传输协议(HTTP) 503服务不可用服务器错误响应代码表示服务器未准备好处理请求。常见原因是服务器停机维护或过载。看现在怎么处理。</p><p id="fb9f" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">有时，你的网站需要一些停机时间，所以你可以修复东西或更新插件。大多数时候，这往往是一个相对较短的时期，在此期间，谷歌很可能不会试图抓取你的<a class="ae jp" href="https://visualmodo.com/" rel="noopener ugc nofollow" target="_blank">网站</a>。然而，在你需要更多时间来修复的情况下，GoogleBot很有可能会访问你的网站，然后发现它关闭了。那么，我们如何防止谷歌取消你网站的链接呢？</p><figure class="jr js jt ju fq jv fe ff paragraph-image"><div role="button" tabindex="0" class="jw jx di jy bf jz"><div class="fe ff jq"><img src="../Images/c2ad4631726c5a51b2b9e7ffb92af3b5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*jJsdpTQJX69hjhos.jpg"/></div></div></figure></div><div class="ab cl kc kd hb ke" role="separator"><span class="kf bw bk kg kh ki"/><span class="kf bw bk kg kh ki"/><span class="kf bw bk kg kh"/></div><div class="hn ho hp hq hr"><h1 id="78bf" class="kj kk hu bd kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg dt translated">HTTP状态代码和您</h1><p id="7aec" class="pw-post-body-paragraph ir is hu it b iu lh iw ix iy li ja jb jc lj je jf jg lk ji jj jk ll jm jn jo hn dt translated">对于那些不熟悉<a class="ae jp" href="https://visualmodo.com/" rel="noopener ugc nofollow" target="_blank"> HTTP </a>状态代码的人来说，这里有一个在处理网站维护时适用于你的状态代码的简要总结:</p><ul class=""><li id="7d6b" class="lm ln hu it b iu iv iy iz jc lo jg lp jk lq jo lr ls lt lu dt translated"><strong class="it hv"> 200好吧。</strong>此状态代码表示服务器成功返回响应。</li><li id="363f" class="lm ln hu it b iu lv iy lw jc lx jg ly jk lz jo lr ls lt lu dt translated"><strong class="it hv"> 301永久移动。这告诉浏览器这个页面不再有效，将重定向到正确的页面。</strong></li><li id="428d" class="lm ln hu it b iu lv iy lw jc lx jg ly jk lz jo lr ls lt lu dt translated"><strong class="it hv"> 302 / 307临时移动。这两个HTTP状态代码背后有一些历史记录，但这对浏览器的指示是，您将暂时将浏览器重定向到一个不同的页面，并且当前的URL最终将返回到它以前的状态。</strong></li><li id="1f45" class="lm ln hu it b iu lv iy lw jc lx jg ly jk lz jo lr ls lt lu dt translated"><strong class="it hv"> 404未找到。</strong>此状态代码表示无法找到您试图导航到的页面。</li><li id="e93d" class="lm ln hu it b iu lv iy lw jc lx jg ly jk lz jo lr ls lt lu dt translated"><strong class="it hv"> 410内容已删除。</strong>如果您故意删除了您的内容，并且无法替换，请使用此选项。</li><li id="c67e" class="lm ln hu it b iu lv iy lw jc lx jg ly jk lz jo lr ls lt lu dt translated"><strong class="it hv"> 503服务不可用。</strong>这是您在处理网站维护时想要返回到Google的文件。它告诉谷歌，你实际上是在这个页面上工作，或者其他地方出错了。Google知道当这个状态码被返回时，以后要再次检查页面。这就是我们将要进一步讨论的。</li></ul><p id="8348" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">请注意，Google会将返回200 HTTP状态代码的页面视为Google搜索控制台中的“软404”，尽管该页面上有错误(或非常少的内容)。</p><h1 id="33f5" class="kj kk hu bd kl km ma ko kp kq mb ks kt ku mc kw kx ky md la lb lc me le lf lg dt translated">告诉谷歌你很忙</h1><p id="e447" class="pw-post-body-paragraph ir is hu it b iu lh iw ix iy li ja jb jc lj je jf jg lk ji jj jk ll jm jn jo hn dt translated">如果谷歌在抓取你的网站时遇到404，它通常会从搜索结果中丢弃该页面，直到下次它返回来验证该页面是否已返回。然而，如果谷歌在特定页面上反复遇到404，它最终会推迟重新抓取，这意味着在页面返回搜索结果之前会经过更多时间。</p><p id="c90a" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">为了克服这种潜在的更长时间的排名损失，您需要在处理特定页面时返回503状态代码。根据此RFC 的<a class="ae jp" href="http://www.w3.org/Protocols/rfc2616/rfc2616-sec10.html" rel="noopener ugc nofollow" target="_blank">，503服务不可用状态代码的原始定义是:</a></p><p id="1285" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated"><em class="mf">由于服务器临时过载或维护，服务器当前无法处理请求。这意味着这是一种暂时的情况，经过一段时间后会得到缓解。如果已知，延迟的长度可以在重试后报头中指示。如果没有给出Retry-After，客户端应该像处理500响应一样处理响应。</em></p><p id="f365" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">这意味着返回一个不可用的HTTP 503服务和一个<code class="eh mg mh mi mj b">Retry-After</code>头，这将告诉Google在返回之前要等待多少分钟。这个<strong class="it hv">并不意味着<a class="ae jp" href="https://visualmodo.com/" rel="noopener ugc nofollow" target="_blank">谷歌</a>将在X分钟后再次爬行，但它将确保谷歌不会在此之前的任何时候回来查看。</strong></p><p id="6ba2" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">如果你想实现这个头，有几个选项可以选择。</p><h1 id="b3f4" class="kj kk hu bd kl km ma ko kp kq mb ks kt ku mc kw kx ky md la lb lc me le lf lg dt translated">使用WordPress默认值</h1><p id="590b" class="pw-post-body-paragraph ir is hu it b iu lh iw ix iy li ja jb jc lj je jf jg lk ji jj jk ll jm jn jo hn dt translated">默认情况下，<a class="ae jp" href="https://visualmodo.com/" rel="noopener ugc nofollow" target="_blank"> WordPress </a>在更新插件或WordPress核心时已经返回了一个503。WordPress允许你通过添加一个<code class="eh mg mh mi mj b">maintenance.php</code>到你的<code class="eh mg mh mi mj b">wp-content/</code>目录来覆盖默认的维护页面。请注意，您将负责正确返回错误标题。计划做数据库维护？你也必须处理好这件事。添加一个<code class="eh mg mh mi mj b">db-error.php</code>文件到你的，并且<code class="eh mg mh mi mj b">wp-content/</code>确保你也在这里正确地返回一个错误头。</p><p id="3c60" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">如果你想给你的WordPress网站添加一些更好的东西，看看WP维护模式。这个插件还增加了很多额外的功能，除了我们在前面提到的。</p><p id="afef" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">如果您只是编写自己的代码，并且想要一个易于实现的解决方案，您可以将以下代码片段添加到您的代码库中，并在代码中调用它来确定您是否处于维护模式:</p><pre class="jr js jt ju fq mk mj ml mm aw mn dt"><span id="9ad5" class="mo kk hu mj b fv mp mq l mr ms">function set_503_header() {<br/>    $protocol = 'HTTP/1.0';</span><span id="b9a0" class="mo kk hu mj b fv mt mq l mr ms">    if ( $_SERVER['SERVER_PROTOCOL'] === 'HTTP/1.1' ) {<br/>        $protocol = 'HTTP/1.1';<br/>    }</span><span id="4037" class="mo kk hu mj b fv mt mq l mr ms">    header( $protocol . '503 Service Unavailable', true, 503 );<br/>    header( 'Retry-After: 3600' );<br/>}</span></pre><p id="1e72" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">注意，代码片段中的<code class="eh mg mh mi mj b">3600</code>以秒为单位表示延迟时间。这意味着上面的示例将告诉GoogleBot在一个小时后返回。也可以在<code class="eh mg mh mi mj b">Retry-After</code>中添加一个具体的日期和时间，但是你需要小心你在这里添加的内容，因为添加一个错误的日期可能会导致意想不到的结果。</p><h1 id="7dd7" class="kj kk hu bd kl km ma ko kp kq mb ks kt ku mc kw kx ky md la lb lc me le lf lg dt translated">专业提示</h1><figure class="jr js jt ju fq jv fe ff paragraph-image"><div role="button" tabindex="0" class="jw jx di jy bf jz"><div class="fe ff mu"><img src="../Images/4b489654984511330e9b86f1cf7103c7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*9t7Q5ZaEFqdBM8ka.png"/></div></div></figure><h1 id="3de9" class="kj kk hu bd kl km ma ko kp kq mb ks kt ku mc kw kx ky md la lb lc me le lf lg dt translated">贮藏</h1><p id="a72b" class="pw-post-body-paragraph ir is hu it b iu lh iw ix iy li ja jb jc lj je jf jg lk ji jj jk ll jm jn jo hn dt translated">在使用维护页面和返回503状态代码时，您需要考虑一些事情。如果你经常使用缓存，你可能会遇到缓存不能正确传递503状态的情况，所以请确保在你的<a class="ae jp" href="https://visualmodo.com/" rel="noopener ugc nofollow" target="_blank">网站</a>的实时版本上经常使用它之前，你能正确地测试它。</p><h1 id="c901" class="kj kk hu bd kl km ma ko kp kq mb ks kt ku mc kw kx ky md la lb lc me le lf lg dt translated">Robots.txt</h1><p id="8a78" class="pw-post-body-paragraph ir is hu it b iu lh iw ix iy li ja jb jc lj je jf jg lk ji jj jk ll jm jn jo hn dt translated">你知道还可以为你的机器人返回一个503状态码吗？来自谷歌的Pierre Far在<a class="ae jp" href="https://plus.google.com/+PierreFar/posts/Gas8vjZ5fmB" rel="noopener ugc nofollow" target="_blank">的这篇文章</a>中解释说，如果你在robots.txt文件中返回503状态码，谷歌将停止抓取你的网站。这样做的最大好处是在维护期间减少了服务器负载。</p><h1 id="52b6" class="kj kk hu bd kl km ma ko kp kq mb ks kt ku mc kw kx ky md la lb lc me le lf lg dt translated">处理好你的保养！</h1><p id="1cf0" class="pw-post-body-paragraph ir is hu it b iu lh iw ix iy li ja jb jc lj je jf jg lk ji jj jk ll jm jn jo hn dt translated">正如我们所看到的，当你做网站维护的时候，你可以通过添加一个503来避免失去排名，让谷歌知道它以后可以回来抓取你的网站。有几种方法可以做到这一点。选择最适合你的，你将拥有一个维护良好的网站，没有失去排名的危险。祝你好运！</p></div></div>    
</body>
</html>