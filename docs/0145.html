<html>
<head>
<title>Improve WordPress Search Function</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">改进WordPress搜索功能</h1>
<blockquote>原文：<a href="https://medium.com/visualmodo/improve-wordpress-search-function-67c8bb738dc3?source=collection_archive---------0-----------------------#2018-02-28">https://medium.com/visualmodo/improve-wordpress-search-function-67c8bb738dc3?source=collection_archive---------0-----------------------#2018-02-28</a></blockquote><div><div class="ef hi hj hk hl hm"/><div class="hn ho hp hq hr"><div class=""/><p id="0426" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">查看一些很棒的提示和技巧来改进WordPress搜索功能，更好地在你的站点上为你的视图和用户展示内容。</p><h1 id="ff7f" class="jp jq hu bd jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km dt translated">根据相关性</h1><p id="634a" class="pw-post-body-paragraph ir is hu it b iu kn iw ix iy ko ja jb jc kp je jf jg kq ji jj jk kr jm jn jo hn dt translated">在旧版本的WordPress中，搜索结果是按日期排序的，除此之外别无其他。因为这对有很多帖子的网站来说(至少)是令人讨厌的，所以<a class="ae ks" href="https://visualmodo.com/" rel="noopener ugc nofollow" target="_blank"> WordPress </a> core推出了一个补丁，将改变搜索结果的排序方式。</p><p id="b673" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">变化如下:</p><ul class=""><li id="5859" class="kt ku hu it b iu iv iy iz jc kv jg kw jk kx jo ky kz la lb dt translated">在文章标题中有完整句子匹配的结果首先列出。</li><li id="ca7b" class="kt ku hu it b iu lc iy ld jc le jg lf jk lg jo ky kz la lb dt translated">包含标题中所有搜索词的搜索结果，但不是完整的句子匹配，将在下面列出。</li><li id="99a1" class="kt ku hu it b iu lc iy ld jc le jg lf jk lg jo ky kz la lb dt translated">接下来会列出标题中包含任何搜索词，但不是所有搜索词或完整句子匹配的结果。</li><li id="5684" class="kt ku hu it b iu lc iy ld jc le jg lf jk lg jo ky kz la lb dt translated">最后，在文章内容中包含完整句子匹配的搜索结果排在最后。在每个组中，结果按出版日期的时间顺序进一步排序。</li></ul><h1 id="f39b" class="jp jq hu bd jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km dt translated">改进WordPress搜索功能</h1><figure class="li lj lk ll fq lm fe ff paragraph-image"><div role="button" tabindex="0" class="ln lo di lp bf lq"><div class="fe ff lh"><img src="../Images/49061ce2bb4a32e00e5f3d4693d1c3cc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*kg50PKCPFbiMbNDv.jpg"/></div></div></figure><p id="8021" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">WordPress搜索结果中的摘录并不太好。与谷歌不同，WordPress搜索如果找到匹配，会忽略关键词的强调。幸运的是，您可以修改部分搜索结果并添加这个特性。</p><h1 id="4f31" class="jp jq hu bd jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km dt translated">准备您的主题</h1><p id="744f" class="pw-post-body-paragraph ir is hu it b iu kn iw ix iy ko ja jb jc kp je jf jg kq ji jj jk kr jm jn jo hn dt translated">在你的主题中，寻找输出搜索结果的文件。在这个例子中，这是一个我手动创建的文件，在<code class="eh lt lu lv lw b">/template-parts/post/content-search.php</code>中称为Twenty子主题。这个文件是存在于同一个目录中的<code class="eh lt lu lv lw b">content-excerpt.php</code>的副本。</p><p id="c1f6" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">接下来，在<a class="ae ks" href="https://visualmodo.com/" rel="noopener ugc nofollow" target="_blank">主题的</a>主目录中查找名为<code class="eh lt lu lv lw b">search.php</code>的文件，并查找以下代码行:</p><pre class="li lj lk ll fq lx lw ly lz aw ma dt"><span id="e4b1" class="mb jq hu lw b fv mc md l me mf">get_template_part( 'template-parts/post/content', 'excerpt' );</span></pre><p id="e804" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">将此更改为以下内容:</p><pre class="li lj lk ll fq lx lw ly lz aw ma dt"><span id="d8d8" class="mb jq hu lw b fv mc md l me mf">get_template_part( 'template-parts/post/content', 'search' );</span></pre><p id="ec75" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">通过做这些改变，你将确保WordPress将使用你的自定义模板而不是默认模板。是时候添加强调的实际代码了！</p><p id="8da6" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">打开<code class="eh lt lu lv lw b">functions.php</code>，增加以下功能:</p><pre class="li lj lk ll fq lx lw ly lz aw ma dt"><span id="296c" class="mb jq hu lw b fv mc md l me mf">/**<br/> * Adds emphasis to the parts passed in $content that are equal to $search_query.<br/> *<br/> * @param $content The content to alter.<br/> * @param $search_query The search query to match against.<br/> *<br/> * @return string The emphasized text.<br/> */<br/>function emphasize( $content, $search_query ) {<br/>    $keys = array_map( 'preg_quote', explode(" ", $search_query ) );<br/>    return preg_replace( '/(' . implode('|', $keys ) .')/iu', '&lt;strong class="search-excerpt"&gt;\0&lt;/strong&gt;', $content );<br/>}</span></pre><p id="e142" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">这个函数的作用是接受传递的内容，强调每个传入的单词，然后<code class="eh lt lu lv lw b">$search_query</code>返回文本。添加到标签<code class="eh lt lu lv lw b">&lt;strong&gt;</code>中的类可以用来进一步设计最终结果的样式(如果你愿意的话)。</p><h1 id="cb7c" class="jp jq hu bd jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km dt translated">在标题中增加重点</h1><figure class="li lj lk ll fq lm fe ff paragraph-image"><div class="fe ff mg"><img src="../Images/0fa2550310faa73d84a51ed1530bdaa3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1060/format:webp/0*4IyfaZFnMNXfOEUZ.png"/></div></figure><p id="ca39" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">现在我们已经完成了设置自定义模板部件的步骤，在标题中添加强调相对容易。</p><p id="e851" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">进入您新创建的<code class="eh lt lu lv lw b">content-search.php</code>,找到看起来像这样的行:</p><pre class="li lj lk ll fq lx lw ly lz aw ma dt"><span id="4359" class="mb jq hu lw b fv mc md l me mf">the_title( sprintf( '&lt;h2 class="entry-title"&gt;&lt;a href="%s" rel="bookmark"&gt;', esc_url( get_permalink() ) ), '&lt;/a&gt;&lt;/h2&gt;' );</span></pre><p id="e576" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">并替换为以下内容:</p><pre class="li lj lk ll fq lx lw ly lz aw ma dt"><span id="2b6c" class="mb jq hu lw b fv mc md l me mf">$title = emphasize( get_the_title(), get_search_query() );</span><span id="c951" class="mb jq hu lw b fv mh md l me mf">echo sprintf( '&lt;h2 class="entry-title"&gt;&lt;a href="%s" rel="bookmark"&gt;%s', esc_url( get_permalink() ), $title ) . '&lt;/a&gt;&lt;/h2&gt;';</span></pre><p id="b752" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">这就是全部了！</p><h1 id="d4ca" class="jp jq hu bd jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km dt translated">在摘录中增加重点</h1><figure class="li lj lk ll fq lm fe ff paragraph-image"><div role="button" tabindex="0" class="ln lo di lp bf lq"><div class="fe ff mi"><img src="../Images/8a288395c46bfbe55edfddf02f5a7318.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*SeISG2bQCNx-Yt7c.jpg"/></div></div></figure><p id="701e" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">你可能会认为在摘录中增加重点不会比在标题中增加重点更难。可悲的是，事实并非如此。有了摘录，WordPress会自动在末尾连接一个“继续阅读”链接。只要搜索短语不出现在文章的段落中，你就不会有问题，但大多数时候，如果你在寻找特定的关键词，它会出现在段落中。这导致“继续阅读”<a class="ae ks" href="https://visualmodo.com/" rel="noopener ugc nofollow" target="_blank">链接</a>断开。</p><p id="589c" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">为了克服这一点，你必须暂时否决一些默认的WordPress行为。</p><p id="10a3" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">首先，将以下内容添加到您的<code class="eh lt lu lv lw b">functions.php</code>:</p><pre class="li lj lk ll fq lx lw ly lz aw ma dt"><span id="e4d5" class="mb jq hu lw b fv mc md l me mf">/**<br/> * Creates a custom read more link.<br/> *<br/> * @return string The read more link.<br/> */<br/>function modify_read_more_link() {<br/>    return ' &lt;a class="more-link" href="' . get_permalink() . '"&gt;Continue reading&lt;/a&gt;';<br/>}</span></pre><p id="4388" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">上面的代码将被调用，以确保我们有一个可行的“阅读更多”链接。</p><p id="51e7" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">这一部分挂钩到创建实际摘录的函数，并添加我们的重点和自定义的“阅读更多”链接。</p><pre class="li lj lk ll fq lx lw ly lz aw ma dt"><span id="9e48" class="mb jq hu lw b fv mc md l me mf">/**<br/> * Allows for excerpt generation outside the loop.<br/> *<br/> * @param string $text  The text to be trimmed<br/> * @return string       The trimmed text<br/> */<br/>function custom_trim_excerpt( $text = '' ) {<br/>    $text = strip_shortcodes( $text );<br/>    $text = apply_filters('the_content', $text);<br/>    $text = str_replace(']]&gt;', ']]&amp;gt;', $text);</span><span id="ee7f" class="mb jq hu lw b fv mh md l me mf">    $excerpt_length = apply_filters('excerpt_length', 55);</span><span id="b4a4" class="mb jq hu lw b fv mh md l me mf">    $trimmed = wp_trim_words( $text, $excerpt_length, '' );</span><span id="d454" class="mb jq hu lw b fv mh md l me mf">    if ( is_search() ) {<br/>        $trimmed = emphasize( $trimmed, get_search_query() );<br/>    }</span><span id="0f93" class="mb jq hu lw b fv mh md l me mf">    return $trimmed . modify_read_more_link();<br/>}<br/>add_filter('wp_trim_excerpt', 'custom_trim_excerpt');</span></pre><p id="6bbd" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">遗憾的是，对此没有更好的选择。希望有一天，可以创建一个可以调用的过滤器，而不是否决trim函数的大部分。</p><h1 id="26c1" class="jp jq hu bd jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km dt translated">跟踪搜索</h1><p id="b7d3" class="pw-post-body-paragraph ir is hu it b iu kn iw ix iy ko ja jb jc kp je jf jg kq ji jj jk kr jm jn jo hn dt translated">有几个选项可以跟踪访问者输入的搜索查询，但我们建议使用谷歌分析。要开始跟踪搜索，请完成以下步骤:</p><ol class=""><li id="7010" class="kt ku hu it b iu iv iy iz jc kv jg kw jk kx jo mj kz la lb dt translated">登录谷歌分析。</li><li id="614f" class="kt ku hu it b iu lc iy ld jc le jg lf jk lg jo mj kz la lb dt translated">点击管理(左下角的齿轮)。</li><li id="5de4" class="kt ku hu it b iu lc iy ld jc le jg lf jk lg jo mj kz la lb dt translated">在视图下，单击视图设置</li><li id="809f" class="kt ku hu it b iu lc iy ld jc le jg lf jk lg jo mj kz la lb dt translated">向下滚动，直到找到站点搜索跟踪开关并将其打开。</li><li id="8803" class="kt ku hu it b iu lc iy ld jc le jg lf jk lg jo mj kz la lb dt translated">在查询参数字段中，输入<code class="eh lt lu lv lw b">s</code>。这是WordPress在使用搜索功能时添加的默认查询参数。</li><li id="2e7d" class="kt ku hu it b iu lc iy ld jc le jg lf jk lg jo mj kz la lb dt translated">单击保存</li></ol><p id="f98e" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">如果你的网站严重依赖于类别，并允许用户使用它们来优化搜索，谷歌<a class="ae ks" href="https://visualmodo.com/" rel="noopener ugc nofollow" target="_blank">分析</a>也给你添加跟踪的能力。获取更多关于这个主题的信息。</p><h1 id="58c1" class="jp jq hu bd jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km dt translated">可供选择的事物</h1><figure class="li lj lk ll fq lm fe ff paragraph-image"><div role="button" tabindex="0" class="ln lo di lp bf lq"><div class="fe ff lh"><img src="../Images/afc686bc3be05e18921b86b9876133f7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*mm014deNGX0mnbkb.png"/></div></div></figure><p id="4134" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">幸运的是，当你想改善网站的搜索功能时，有一些选择。正如评论中指出的，插件Relevanssi解决了搜索中的大多数问题，并帮助您快速轻松地开始。</p><p id="594a" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">如果你的网站发展很快，你想增加搜索量，甚至更多，看看一些更复杂的选择可能是明智的。我们在Yoast使用的一个是Algolia。这个平台包含了大量的功能，使搜索变得更好。一些特性包括允许输入错误、支持同义词、过滤器和支持100多种语言。它还包括与WordPress的集成！</p><p id="c555" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">另一个选择是<a class="ae ks" href="https://aws.amazon.com/cloudsearch/" rel="noopener ugc nofollow" target="_blank">亚马逊云搜索</a>。它提供了与Algolia类似的功能，如果你认为你的网站需要，你可以启用自动缩放。然而，ACS不提供开箱即用的集成，所以你必须自己编写实现或者在插件目录中寻找WordPress插件。在撰写本文时，只有两个插件；云搜索和电梯。</p><h1 id="5944" class="jp jq hu bd jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km dt translated">是的，你可以改进WordPress搜索</h1><p id="dcae" class="pw-post-body-paragraph ir is hu it b iu kn iw ix iy ko ja jb jc kp je jf jg kq ji jj jk kr jm jn jo hn dt translated">正如你所看到的，WordPress搜索引擎这些年来已经有所改进。尽管如此，它在某些方面还是有所欠缺。幸运的是，你可以通过在你的孩子主题中添加一些额外的代码来改进它，或者通过使用Algolia和Amazon CloudSearch等外部服务来提升它。祝你好运！</p></div></div>    
</body>
</html>