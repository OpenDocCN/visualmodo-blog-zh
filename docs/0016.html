<html>
<head>
<title>How to Code Your Own Custom WordPress Widget</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何编写你自己的定制WordPress小部件</h1>
<blockquote>原文：<a href="https://medium.com/visualmodo/how-to-code-your-own-custom-wordpress-widget-b7f4759ff098?source=collection_archive---------1-----------------------#2017-09-12">https://medium.com/visualmodo/how-to-code-your-own-custom-wordpress-widget-b7f4759ff098?source=collection_archive---------1-----------------------#2017-09-12</a></blockquote><div><div class="ef hi hj hk hl hm"/><div class="hn ho hp hq hr"><div class=""/><p id="befc" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">你曾经想要为你的WordPress网站创建一个自定义的小部件吗？虽然WordPress确实包含一个内置的文本小部件，可以用来显示HTML以及嵌入的CSS和JavaScript，但如果你想做更多的事情，文本小部件就不能满足你。了解如何编写你自己的定制WordPress小部件</p><p id="6d3a" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">如果您想从您的网站数据库中抓取一些内容并在一个小部件中显示它，该怎么办？解决方案是编写一个定制的侧边栏小部件。虽然这听起来像是一项艰巨的任务，但只要你有基本的PHP技能，这是你力所能及的。</p><p id="6c8f" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">因此，跟随本教程，您将学习如何创建两个不同的小部件:</p><ul class=""><li id="98d7" class="jp jq hu it b iu iv iy iz jc jr jg js jk jt jo ju jv jw jx dt translated">一个简单的小部件，显示小部件标题、站点标题和站点标语。</li><li id="6dec" class="jp jq hu it b iu jy iy jz jc ka jg kb jk kc jo ju jv jw jx dt translated">一个稍微复杂一点的小部件，显示所有类别的列表，这些类别按字母顺序排序并分成两列。</li></ul><p id="8e88" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">准备好学习自定义WordPress小部件创建的基础知识了吗？我们开始吧。</p><h1 id="4ded" class="kd ke hu bd kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la dt translated">WordPress小部件构建基础</h1><p id="7d4c" class="pw-post-body-paragraph ir is hu it b iu lb iw ix iy lc ja jb jc ld je jf jg le ji jj jk lf jm jn jo hn dt translated">为了完成本教程，您需要做好三件事情:</p><ul class=""><li id="c472" class="jp jq hu it b iu iv iy iz jc jr jg js jk jt jo ju jv jw jx dt translated">WordPress开发环境</li><li id="d495" class="jp jq hu it b iu jy iy jz jc ka jg kb jk kc jo ju jv jw jx dt translated">基本的PHP编码技能</li><li id="a45c" class="jp jq hu it b iu jy iy jz jc ka jg kb jk kc jo ju jv jw jx dt translated">基本的WordPress开发经验</li></ul><p id="dba5" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">WordPress网站崩溃只需要一个错误的逗号或丢失的花括号，如果你相对来说是编程新手，当你试图定位违规代码时，你的网站可能会宕机几分钟或更长时间。出于这个原因，在您尝试在一个真实的网站上使用它之前，您绝对应该让您的小部件在本地开发环境中工作。</p><p id="8bae" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">过去，我们已经写了很多关于本地开发环境的文章。就我个人而言，<a class="ae lg" href="https://premium.wpmudev.org/blog/setting-up-xampp/" rel="noopener ugc nofollow" target="_blank">我使用XAMPP </a>，但是任何本地主机服务器都可以。选择一个并运行它。</p><p id="8431" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">如果你从来没有写过一行PHP代码或者编写过一个基本的WordPress插件，那么这篇教程可能有点超出你的能力范围。然而，好消息是，你可以通过非正式的方式学习你需要知道的一切，通过我们的<a class="ae lg" href="https://premium.wpmudev.org/blog/wordpress-development-beginners-getting-started" rel="noopener ugc nofollow" target="_blank"> WordPress初学者开发系列</a>，或者通过在<a class="ae lg" href="https://premium.wpmudev.org/academy" rel="noopener ugc nofollow" target="_blank">学院</a>注册一个即将到来的课程。</p><p id="31e8" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">如果你满足了这三个基本要求，你就可以开始编写代码了。我们开始吧。</p><h1 id="8ff4" class="kd ke hu bd kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la dt translated">Widgets API </h1><figure class="li lj lk ll fq lm fe ff paragraph-image"><div class="fe ff lh"><img src="../Images/b7aa0396a856e8d30f32af132d6fbe38.png" data-original-src="https://miro.medium.com/v2/resize:fit:1340/format:webp/0*z_4zOTH8a6g67ldG.png"/></div></figure></div><div class="ab cl lp lq hb lr" role="separator"><span class="ls bw bk lt lu lv"/><span class="ls bw bk lt lu lv"/><span class="ls bw bk lt lu"/></div><div class="hn ho hp hq hr"><p id="a3d8" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">你可以在WordPress Codex中找到更多关于Widget API的信息。</p><p id="7dbc" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">您可以通过向以下两个位置之一添加代码来创建一个新的WordPress小部件:</p><ul class=""><li id="60a9" class="jp jq hu it b iu iv iy iz jc jr jg js jk jt jo ju jv jw jx dt translated">一个自定义插件，如果你想在多个主题或者多个网站上使用这个插件。</li><li id="2388" class="jp jq hu it b iu jy iy jz jc ka jg kb jk kc jo ju jv jw jx dt translated">活动主题的<em class="lw">functions.php</em>文件——可以是子主题，也可以是完全自定义的主题。</li></ul><p id="e095" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">仅仅为了举例，您可以在GitHub上找到本教程中描述的简单侧边栏小部件的完整代码。如果你不确定在哪里写你的代码，或者只想立刻看到整个代码，<a class="ae lg" href="https://github.com/jpen365/example-widget-plugin/releases/tag/1.0" rel="noopener ugc nofollow" target="_blank">下载那个插件的副本</a>。</p><p id="14db" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">WordPress小部件是用一点面向对象的编程<a class="ae lg" href="https://premium.wpmudev.org/blog/advanced-wordpress-development-introduction-to-oop" rel="noopener ugc nofollow" target="_blank">创建的</a>。扩展了<code class="eh lx ly lz ma b"><a class="ae lg" href="https://developer.wordpress.org/reference/classes/wp_widget/" rel="noopener ugc nofollow" target="_blank">WP_Widget</a></code>类来创建每个小部件。<code class="eh lx ly lz ma b">WP_Widget</code>类包含近20种不同的方法。然而，对于基本的小部件，您实际上只需要使用其中的四个:</p><ul class=""><li id="c170" class="jp jq hu it b iu iv iy iz jc jr jg js jk jt jo ju jv jw jx dt translated"><code class="eh lx ly lz ma b">__construct()</code>:注册基本小工具信息。</li><li id="86d3" class="jp jq hu it b iu jy iy jz jc ka jg kb jk kc jo ju jv jw jx dt translated"><code class="eh lx ly lz ma b">widget()</code>:包含小部件输出——当小部件被添加到小部件区域时，您在站点前端实际看到的内容。</li><li id="f8b1" class="jp jq hu it b iu jy iy jz jc ka jg kb jk kc jo ju jv jw jx dt translated"><code class="eh lx ly lz ma b">form()</code>:定义在WordPress管理区域显示的小部件设置。</li><li id="4953" class="jp jq hu it b iu jy iy jz jc ka jg kb jk kc jo ju jv jw jx dt translated"><code class="eh lx ly lz ma b">update()</code>:当新设置保存在WordPress管理区时，更新小工具设置。</li></ul><p id="99a2" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">除了这四个方法之外，<code class="eh lx ly lz ma b"><a class="ae lg" href="https://developer.wordpress.org/reference/functions/add_action/" rel="noopener ugc nofollow" target="_blank">add_action</a></code>函数还用于将自定义小部件函数绑定到<code class="eh lx ly lz ma b"><a class="ae lg" href="https://developer.wordpress.org/reference/hooks/widgets_init/" rel="noopener ugc nofollow" target="_blank">widgets_init</a></code>钩子上。</p><h1 id="9572" class="kd ke hu bd kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la dt translated">示例小部件#1:显示小部件标题、站点标题和标语</h1><p id="0f26" class="pw-post-body-paragraph ir is hu it b iu lb iw ix iy lc ja jb jc ld je jf jg le ji jj jk lf jm jn jo hn dt translated">首先要做的是像这样扩展<code class="eh lx ly lz ma b">WP_Widget</code>类:</p><p id="e5de" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated"><?phpclass jpen_Example_Widget extends WP_Widget { /** * To create the example widget all four methods will be * nested inside this single instance of the WP_Widget class. **/}?></p><p id="d061" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">在这种情况下，新widget函数的名称是<code class="eh lx ly lz ma b">jpen_Example_Widget</code>。请注意，<em class="lw"> jpen </em>只是我添加到所有自定义函数的前缀，以避免与其他插件、主题或WordPress核心中的任何函数冲突。您可以使用适合您的小部件的任何名称，如果您想遵循最佳实践，可以添加前缀。</p><p id="9574" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">我们将使用上面列表中提到的四种方法编写函数，并将所有四种方法嵌套在我们的小部件函数中。然后，在最后一步，我们将编写一个函数来注册小部件。</p><p id="1f50" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">让我们从<code class="eh lx ly lz ma b">__construct()</code>方法开始方法编写过程。</p><h2 id="451f" class="mb ke hu bd kf mc md me kj mf mg mh kn jc mi mj kr jg mk ml kv jk mm mn kz mo dt translated">WP _ Widget::_ _构造()</h2><p id="7dee" class="pw-post-body-paragraph ir is hu it b iu lb iw ix iy lc ja jb jc ld je jf jg le ji jj jk lf jm jn jo hn dt translated"><code class="eh lx ly lz ma b"><a class="ae lg" href="https://developer.wordpress.org/reference/classes/wp_widget/__construct/" rel="noopener ugc nofollow" target="_blank">__construct()</a></code>方法用于为小部件分配id、标题、类名和描述。下面是构造函数创建第一个示例小部件的样子:</p><p id="f88b" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated"><?phppublic function __construct() { $widget_options = array( ‘classname’ => 'example_widget '，' description' = > '这是一个示例小部件'，)；parent::_ _ construct(' Example _ Widget '，' Example Widget '，$ Widget _ options)；}?></p><p id="2f21" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">要理解这个函数，先从以<code class="eh lx ly lz ma b">parent::__construct()</code>开头的那一行开始。这一行创建了一个新的小部件，id为<code class="eh lx ly lz ma b">'example-widget'</code>，名称为<code class="eh lx ly lz ma b">'Example Widget'</code>，有两个小部件选项:类名和简短描述。</p><p id="1d58" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">所有这些代码都在<code class="eh lx ly lz ma b">jpen_Example_Widget</code>中，用于向WordPress注册小部件，然后在管理区显示小部件的标题和描述。</p><figure class="li lj lk ll fq lm fe ff paragraph-image"><div class="fe ff lh"><img src="../Images/e64a4ad25d54b27eab5cde731b6d5a81.png" data-original-src="https://miro.medium.com/v2/resize:fit:1340/format:webp/0*8oGGDE90GEa_5z-S.png"/></div></figure></div><div class="ab cl lp lq hb lr" role="separator"><span class="ls bw bk lt lu lv"/><span class="ls bw bk lt lu lv"/><span class="ls bw bk lt lu"/></div><div class="hn ho hp hq hr"><h2 id="320f" class="mb ke hu bd kf mc md me kj mf mg mh kn jc mi mj kr jg mk ml kv jk mm mn kz mo dt translated">WP_Widget::widget()</h2><p id="a269" class="pw-post-body-paragraph ir is hu it b iu lb iw ix iy lc ja jb jc ld je jf jg le ji jj jk lf jm jn jo hn dt translated">下一步是使用<code class="eh lx ly lz ma b"><a class="ae lg" href="https://developer.wordpress.org/reference/classes/wp_widget/widget/" rel="noopener ugc nofollow" target="_blank">widget()</a></code>方法定义将在站点前端显示的小部件输出。</p><p id="bb39" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated"><code class="eh lx ly lz ma b">widget()</code>所做的是包含生成小部件显示的实际内容的代码。<code class="eh lx ly lz ma b">widget()</code>的内容可以是任何东西，但通常会包括一些PHP。否则，你可以使用WordPress内置的文本小部件。</p><p id="fb61" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">在我们的例子中，我们将为用户提供显示自定义小部件标题的选项。所以我们需要获取标题，然后使用<code class="eh lx ly lz ma b">get_bloginfo()</code>来显示博客标题和标语。下面是我们将使用的代码:</p><p id="8c11" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated"><?phppublic function widget( $args, $instance ) { $title = apply_filters( ‘widget_title’, $instance[ ‘title’ ] ); $blog_title = get_bloginfo( ‘name’ ); $tagline = get_bloginfo( ‘description’ ); echo $args[‘before_widget’] . $args[‘before_title’] . $title . $args[‘after_title’]; ?> <p> <strong>网站名称:</strong> <?php echo $blog_title ?> </p> <p> <strong>标语:</strong> <?php echo $tagline ?> </p> <?php echo $args[‘after_widget’];}?></p><p id="51e8" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">在这个函数中有几件事情需要你花时间去理解:</p><ul class=""><li id="ec3a" class="jp jq hu it b iu iv iy iz jc jr jg js jk jt jo ju jv jw jx dt translated"><code class="eh lx ly lz ma b">$args[]</code>:这个变量加载<a class="ae lg" href="https://codex.wordpress.org/Function_Reference/register_sidebar" rel="noopener ugc nofollow" target="_blank">一个参数数组，可以在构建小部件输出</a>时使用。当注册侧边栏区域时，<code class="eh lx ly lz ma b">$args</code>中包含的值由活动主题设置。</li><li id="5e34" class="jp jq hu it b iu jy iy jz jc ka jg kb jk kc jo ju jv jw jx dt translated"><code class="eh lx ly lz ma b">$instance[]</code>:该变量加载与小部件当前实例相关的值。如果您向侧边栏添加一个小部件两次，每个<code class="eh lx ly lz ma b">$instance</code>将保存特定于小部件每个实例的值。</li><li id="87a9" class="jp jq hu it b iu jy iy jz jc ka jg kb jk kc jo ju jv jw jx dt translated"><code class="eh lx ly lz ma b"><a class="ae lg" href="https://codex.wordpress.org/Plugin_API/Filter_Reference/widget_title" rel="noopener ugc nofollow" target="_blank">widget_title filter</a></code>:返回当前小工具实例的标题。</li><li id="9491" class="jp jq hu it b iu jy iy jz jc ka jg kb jk kc jo ju jv jw jx dt translated"><code class="eh lx ly lz ma b"><a class="ae lg" href="https://developer.wordpress.org/reference/functions/get_bloginfo/" rel="noopener ugc nofollow" target="_blank">get_bloginfo()</a></code>:这个函数可以用来返回WordPress网站的各种元数据，包括网站名称和标语。</li></ul><p id="3560" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">在使用上面列表中的信息定义了几个变量之后，代码接着产生实际的输出，其中包括来自<code class="eh lx ly lz ma b">$args</code>的信息、标题、网站名称和标语。</p><p id="be4f" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">注意，几乎每个小部件都应该包含<code class="eh lx ly lz ma b">'before_widget'</code>、<code class="eh lx ly lz ma b">'after_widget'</code>、<code class="eh lx ly lz ma b">'before_title'</code>和<code class="eh lx ly lz ma b">'after_title'</code>参数。它们对于确保每个小部件嵌套在特定于主题的HTML标签中是必要的。</p><p id="8a12" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">整个<code class="eh lx ly lz ma b">widget()</code>方法应该嵌套在<code class="eh lx ly lz ma b">jpen_Example_Widget</code>中。</p><h2 id="eeb6" class="mb ke hu bd kf mc md me kj mf mg mh kn jc mi mj kr jg mk ml kv jk mm mn kz mo dt translated">WP_Widget::form()</h2><p id="b893" class="pw-post-body-paragraph ir is hu it b iu lb iw ix iy lc ja jb jc ld je jf jg le ji jj jk lf jm jn jo hn dt translated">方法<code class="eh lx ly lz ma b"><a class="ae lg" href="https://developer.wordpress.org/reference/classes/wp_widget/form/" rel="noopener ugc nofollow" target="_blank">form()</a></code>用于给将显示在WordPress管理区的小部件添加设置字段。</p><p id="14dc" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">在这个部门，包含许多选项的小部件将会非常复杂。然而，在我们的示例小部件中，我们想要做的只是允许用户为小部件指定一个自定义标题。所以事情很简单。</p><p id="f6ee" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated"><?phppublic function form( $instance ) { $title = ! empty( $instance[‘title’] ) ? $instance[‘title’] : ‘’; ??><p><label for="”&lt;?php" echo="">get _ field _ id(‘标题’)；？&gt; " &gt; Title:</label><input type="”text”" id="”&lt;?php" echo=""/>get _ field _ id(' Title ')；？&gt; " name = "<?php echo $this-?>get _ field _ name(' title ')；？&gt; " value=" <?php echo esc_attr( $title ); ??> " /&gt; </p> <?php }??></p><p id="4810" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">该函数通过调用参数<code class="eh lx ly lz ma b">$instance</code>返回小部件特定实例的当前值。然后，我们检查当前的实例信息，看标题是否为空。如果不是，我们显示当前标题。</p><p id="b4e9" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">接下来，嵌套在段落标记中的标签和输入元素为用户创建一个带标签的输入字段，以便添加新的标题。</p><p id="f522" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">将这段代码添加到<code class="eh lx ly lz ma b">jpen_Example_Widget</code>后，小部件设置将如下所示:</p><figure class="li lj lk ll fq lm fe ff paragraph-image"><div class="fe ff lh"><img src="../Images/7f2e77c0ef1151a1cd63a0be2b9450b1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1340/format:webp/0*oAR_22t4I6ralWhR.png"/></div></figure></div><div class="ab cl lp lq hb lr" role="separator"><span class="ls bw bk lt lu lv"/><span class="ls bw bk lt lu lv"/><span class="ls bw bk lt lu"/></div><div class="hn ho hp hq hr"><h2 id="8c71" class="mb ke hu bd kf mc md me kj mf mg mh kn jc mi mj kr jg mk ml kv jk mm mn kz mo dt translated">WP_Widget::update()</h2><p id="9067" class="pw-post-body-paragraph ir is hu it b iu lb iw ix iy lc ja jb jc ld je jf jg le ji jj jk lf jm jn jo hn dt translated">下一步是使用<code class="eh lx ly lz ma b"><a class="ae lg" href="https://developer.wordpress.org/reference/classes/wp_widget/update/" rel="noopener ugc nofollow" target="_blank">update()</a></code>方法更新WordPress数据库中的信息。</p><p id="281a" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">这个方法需要两个参数:<code class="eh lx ly lz ma b">$new_instance</code>和<code class="eh lx ly lz ma b">$old_instance</code>。第一个包含添加到小部件设置表单的值。第二个包含现有的设置—如果有的话。</p><p id="f094" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated"><code class="eh lx ly lz ma b">update()</code>方法应该适当地验证新设置，然后将它们分配给<code class="eh lx ly lz ma b">$instance</code>变量，并返回更新后的变量。如果这听起来有点复杂，下面的例子应该可以澄清一些事情。</p><p id="9393" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated"><?phppublic function update( $new_instance, $old_instance ) { $instance = $old_instance; $instance[ ‘title’ ] = strip_tags( $new_instance[ ‘title’ ] ); return $instance;}?></p><p id="492f" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">在我们的示例小部件中，我们所做的只是更新标题。所以我们需要做的就是:</p><ol class=""><li id="c7c9" class="jp jq hu it b iu iv iy iz jc jr jg js jk jt jo mp jv jw jx dt translated">从新实例中获取标题，</li><li id="6d7f" class="jp jq hu it b iu jy iy jz jc ka jg kb jk kc jo mp jv jw jx dt translated">去掉可能添加到小部件标题中的任何HTML或PHP标签，</li><li id="1f85" class="jp jq hu it b iu jy iy jz jc ka jg kb jk kc jo mp jv jw jx dt translated">将标题分配给实例，然后</li><li id="7829" class="jp jq hu it b iu jy iy jz jc ka jg kb jk kc jo mp jv jw jx dt translated">返回更新的实例。</li></ol><h2 id="74e6" class="mb ke hu bd kf mc md me kj mf mg mh kn jc mi mj kr jg mk ml kv jk mm mn kz mo dt translated">注册小部件</h2><p id="e39e" class="pw-post-body-paragraph ir is hu it b iu lb iw ix iy lc ja jb jc ld je jf jg le ji jj jk lf jm jn jo hn dt translated">流程的最后一步是使用<code class="eh lx ly lz ma b">add_action</code>函数和<code class="eh lx ly lz ma b">widget_init</code>钩子注册小部件。以下是如何做到这一点:</p><p id="9bc3" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated"><?phpfunction jpen_register_example_widget() { register_widget( ‘jpen_Example_Widget’ );}add_action( ‘widgets_init’, ‘jpen_register_example_widget’ );?></p><p id="a325" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">首先，我们创建一个函数来注册小部件，并使用小部件对象名来标识它。接下来，我们使用<code class="eh lx ly lz ma b">widgets_init</code>钩子和注册函数的名称将注册函数绑定到WordPress。</p><p id="5d44" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">这位代码加在<code class="eh lx ly lz ma b">jpen_Example_Widget</code>的外<em class="lw">。当它被调用时，它将调出具有适当名称的部件，在本例中是<code class="eh lx ly lz ma b">jpen_Example_Widget</code>，并运行部件中包含的所有代码。</em></p><p id="eb25" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">有了这最后一点代码，我们可以将我们的小部件添加到侧边栏，根据我们的喜好进行配置，并在侧边栏中显示我们的站点标题和标语，如下所示:</p><figure class="li lj lk ll fq lm fe ff paragraph-image"><div class="fe ff lh"><img src="../Images/3ab5541adc36f6c6190402d606ef2cdb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1340/format:webp/0*l0x4LuqfWcb-5uLl.png"/></div></figure><h1 id="d58a" class="kd ke hu bd kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la dt translated">示例小部件#2:在两列中显示类别</h1><p id="bc62" class="pw-post-body-paragraph ir is hu it b iu lb iw ix iy lc ja jb jc ld je jf jg le ji jj jk lf jm jn jo hn dt translated">不久前，我写了一篇教程，解释如何<a class="ae lg" href="https://premium.wpmudev.org/blog/convert-html5-template-wordpress-theme/" rel="noopener ugc nofollow" target="_blank">将任何HTML5模板转换成WordPress主题</a>。然而，我在该教程中没有做的是重新创建模板中包含的任何侧边栏小部件。因此，我们的第二个示例小部件将是来自Start Bootstrap 的<a class="ae lg" href="https://startbootstrap.com/template-overviews/blog-post/" rel="noopener ugc nofollow" target="_blank">博客文章HTML5模板的类别列表侧边栏小部件。</a></p><p id="0639" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">下面是原始HTML5模板中侧边栏小部件的外观:</p><figure class="li lj lk ll fq lm fe ff paragraph-image"><div class="fe ff lh"><img src="../Images/bc6482bcf51ad6f9bf8b09154d01ac74.png" data-original-src="https://miro.medium.com/v2/resize:fit:1340/format:webp/0*DB_KHAyqmHM9sK0n.png"/></div></figure></div><div class="ab cl lp lq hb lr" role="separator"><span class="ls bw bk lt lu lv"/><span class="ls bw bk lt lu lv"/><span class="ls bw bk lt lu"/></div><div class="hn ho hp hq hr"><p id="82ec" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">重新创建这个小部件比我们的简单示例小部件需要更多的代码，但实际上它并不复杂。事实上，<code class="eh lx ly lz ma b">_construct()</code>、<code class="eh lx ly lz ma b">form()</code>、<code class="eh lx ly lz ma b">update()</code>功能基本不变。这个小部件和我们之前的例子之间唯一真正的区别是<code class="eh lx ly lz ma b">widget()</code>输出方法包含了更多的代码。</p><p id="3b13" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">这样做的原因是，为了创建小部件内容，我们需要生成一个所有类别的列表，将列表按字母顺序排序，然后将类别分成两列。虽然有各种各样的方法可以做到这一点，这里有一种方法可以完成这项工作。</p><p id="3dff" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">首先，我创建了<code class="eh lx ly lz ma b">widget()</code>函数:</p><p id="0681" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated"><?phpfunction widget( $args, $instance ) { // All widget output will go here}?></p><p id="1fa8" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">接下来，我创建了几个变量:</p><p id="ad3e" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated"><?php $title = apply_filters( ‘widget_title’, $instance[ ‘title’ ] ); $categories = get_categories( array( ‘orderby’ =?>'名称'，'顺序' = &gt; ' ASC ')；$ cat _ count = 0；$ cat _ col _ one =[]；$ cat _ col _ two =[]；？&gt;</p><p id="f077" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">标题和类别变量是不言自明的。它们包含小部件标题和所有类别的列表。</p><p id="a834" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated"><code class="eh lx ly lz ma b">$cat_count</code>变量将用于跟踪类别的总数，以便我们可以将它们分类到两个列表中。两个列变量<code class="eh lx ly lz ma b">$cat_col_one</code>和<code class="eh lx ly lz ma b">$cat_col_two</code>将用于将类别分成两列。</p><p id="596f" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">接下来是遍历所有类别并将它们分成两列的函数。</p><p id="7593" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated"><?phpforeach ( $categories as $category ) { $cat_count ++; $category_link = sprintf( ‘<li class=”list-unstyled”?><a href="”%1$s”" alt="”%2$s”">% 3 $ s</a>’、ESC _ URL(get _ category _ link($ category-&gt; term _ id))、esc_attr( sprintf( __('查看%s中的所有帖子'，' textdomain ')、$category-&gt;name))、ESC _ html($ category-&gt; name))；if(＄cat _ count % 2！= 0){ $ cat _ col _ one[]= $ category _ link；} else { $ cat _ col _ two[]= $ category _ link；}}?&gt;</p><p id="ed3f" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">对于每个类别，<code class="eh lx ly lz ma b">$cat_count</code>变量迭代并创建一个<code class="eh lx ly lz ma b">$category_link</code>。然后，基于当前的<code class="eh lx ly lz ma b">$cat_count</code>——无论是偶数还是奇数——<code class="eh lx ly lz ma b">$category_variable</code>被添加到第一列或第二列变量中。</p><p id="661d" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">此外，这段代码还将每个类别嵌套到一个列表项中，并使用一个类<code class="eh lx ly lz ma b">"list-unstyled"</code>来匹配原始模板中使用的类和HTML。</p><p id="14a0" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">最后，我们需要实际打印出<code class="eh lx ly lz ma b">$cat_col_one</code>和<code class="eh lx ly lz ma b">$cat_col_two</code>来呈现类别列表:</p><p id="4159" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated"><?phpecho $args[‘before_widget’] . $args[‘before_title’] . $title . $args[‘after_title’]; ??><div class="”row”"><div class="”col-lg-6&quot;"><?php foreach( $cat_col_one as $cat_one ) { echo $cat_one; } ??></div><div class="”col-lg-6&quot;"><?php foreach( $cat_col_two as $cat_two ) { echo $cat_two; } ??></div></div></p><p id="6616" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">该代码遍历每个类别列变量，并将每个类别列表打印到一个div中。分配给小部件的类和HTML结构反映了原始模板中包含的类和结构，以确保原始模板CSS资源中包含的样式正确应用于新的小部件。</p><p id="b2d2" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">下面是侧边栏小部件完成后的样子。如果你回头看看上图中模板中的原始版本，你会发现这是一个完美的匹配！</p><figure class="li lj lk ll fq lm fe ff paragraph-image"><div class="fe ff lh"><img src="../Images/fd349efc685f22d25882cd1d6fc1905a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1340/format:webp/0*Umqe_3fwVABltd5N.png"/></div></figure></div><div class="ab cl lp lq hb lr" role="separator"><span class="ls bw bk lt lu lv"/><span class="ls bw bk lt lu lv"/><span class="ls bw bk lt lu"/></div><div class="hn ho hp hq hr"><p id="6a58" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">如果您想查看创建这个侧边栏小部件的完整代码，请在GitHub的简单博客主题的<a class="ae lg" href="https://github.com/jpen365/simple-blog-theme/blob/master/functions.php" rel="noopener ugc nofollow" target="_blank"><em class="lw">functions.php</em>文件中查找<code class="eh lx ly lz ma b">WP_Widget</code>类的<code class="eh lx ly lz ma b">jpen_Category_List_Widget</code>实例。</a></p><h1 id="f0e3" class="kd ke hu bd kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la dt translated">创建您自己的自定义小部件</h1><p id="baab" class="pw-post-body-paragraph ir is hu it b iu lb iw ix iy lc ja jb jc ld je jf jg le ji jj jk lf jm jn jo hn dt translated">创建自定义侧边栏小部件涉及到使用相当复杂的<code class="eh lx ly lz ma b">WP_Widget</code>类。虽然这看起来有点令人生畏，但好消息是你可以将这个过程归结为五个步骤:</p><p id="9a27" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">使用<code class="eh lx ly lz ma b">__construct()</code>定义基本微件信息。</p><p id="8b86" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">使用<code class="eh lx ly lz ma b">widget()</code>定义微件输出。</p><p id="74c0" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">使用<code class="eh lx ly lz ma b">form()</code>创建管理设置菜单。</p><p id="4059" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">使用<code class="eh lx ly lz ma b">update()</code>来更新widget设置。</p><p id="d49c" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">使用<code class="eh lx ly lz ma b">add_action()</code>将widget对象绑定到合适的挂钩上。</p><p id="fe1c" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">虽然创建自定义小部件可能有点复杂，但要创建强大的自定义小部件，您需要掌握的知识相对有限。想想这五个功能，你就能把你能想到的任何想法变成一个WordPress小部件。</p><p id="bbcc" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">如何编写你自己的定制WordPress小部件——visual modo<a class="ae lg" href="https://visualmodo.com/" rel="noopener ugc nofollow" target="_blank">https://visualmodo.com/</a></p></div></div>    
</body>
</html>