<html>
<head>
<title>How To Use The WordPress Debug Log</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何使用WordPress调试日志</h1>
<blockquote>原文：<a href="https://medium.com/visualmodo/how-to-use-the-wordpress-debug-log-56768a3e7195?source=collection_archive---------0-----------------------#2018-01-06">https://medium.com/visualmodo/how-to-use-the-wordpress-debug-log-56768a3e7195?source=collection_archive---------0-----------------------#2018-01-06</a></blockquote><div><div class="ef hi hj hk hl hm"/><div class="hn ho hp hq hr"><div class=""/><p id="cb9c" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">你犯过错误吗？我知道。纠正错误的第一步是知道错误是什么。我不能解决你所有的问题，但是我可以通过帮助你使用调试日志来帮助你修复那些由你的WordPress站点上的PHP代码产生的问题。</p><p id="4acf" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">几周前，当我写关于定制你的WordPress站点的wp-config.php文件时，我谈到了调试设置。我介绍了如何显示错误，以及何时不希望这样做。虽然启用WP_DEBUG，正如我在那篇文章中所描述的，在开发中是很重要的，但是您可能会有一些非致命的错误和警告，无论出于什么原因，您都不希望向所有的访问者显示这些错误和警告。此外，可能会有你没有意识到的错误和警告，因为你从来没有触发它们，但你的网站的访问者看到了。</p><figure class="jq jr js jt fq ju fe ff paragraph-image"><div class="fe ff jp"><img src="../Images/b215d0b9eb3170d465319c0df1d05374.png" data-original-src="https://miro.medium.com/v2/resize:fit:1276/format:webp/0*erLoRumtuCkvBbdc.jpg"/></div></figure><p id="24d0" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">出于这些原因，在一个活动的站点上，保持WP_DEBUG启用是一个好主意，但是要防止错误被显示出来。为了查看这些错误和警告，您需要将它们写入一个特殊的日志文件，以便您可以查看它们。在这篇文章中，我将介绍设置错误日志和查看日志的各种方法。我还将介绍如何向日志中写入其他信息，以及何时需要这样做。</p><p id="8633" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">记录错误，即使您正在显示它们，仍然是有用的，因为拥有错误记录在开发中通常是非常有用的。当错误第一次出现时，您可能无法理解它，但是一旦您从后续工作中获得了更多信息，日志中的记录可能会非常有用。</p><h1 id="5297" class="jx jy hu bd jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku dt translated">安装</h1><p id="9898" class="pw-post-body-paragraph ir is hu it b iu kv iw ix iy kw ja jb jc kx je jf jg ky ji jj jk kz jm jn jo hn dt translated">这是我在我的wp-config文章中讨论的内容的简要回顾。如果你从来没有编辑过你的站点的wp-config文件，或者不知道什么是WP-config文件，或者什么是常量，我推荐你阅读那篇文章，然后回到这篇文章。</p><p id="f791" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">为了启用调试、防止显示错误和警告以及记录错误，您需要在wp-config中使用这三行代码:</p><pre class="jq jr js jt fq lb lc ld le aw lf dt"><span id="9f19" class="lg jy hu lc b fv lh li l lj lk">define( 'WP_DEBUG', true );<br/>define( 'WP_DEBUG_DISPLAY', false );<br/>define( 'WP_DEBUG_LOG', true );</span></pre><p id="2ff3" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">需要注意的是，除了启用调试显示(debug display)之外，您无法阻止致命错误导致白屏死机，调试显示会向您显示包含错误的白屏。</p><h1 id="8430" class="jx jy hu bd jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku dt translated">查看调试日志</h1><p id="44c2" class="pw-post-body-paragraph ir is hu it b iu kv iw ix iy kw ja jb jc kx je jf jg ky ji jj jk kz jm jn jo hn dt translated">实际的调试日志保存在站点内容目录中名为debug.log的文件中。查看和清除日志的一种方法是直接访问该文件。这不是一个特别好的工作方式，尤其是如果你的站点在远程服务器上。有一些插件可以使调试日志变得更容易，我将很快对此进行讨论。也就是说，熟悉这种方法是很重要的，如果你由于一个致命的错误而不能访问WordPress后端，你的调试日志可能会有线索来理解为什么。</p><p id="5007" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">有多种方法可以从WordPress后端查看你的调试日志。我的首选方法是使用<a class="ae la" href="https://wordpress.org/plugins/log-viewer/" rel="noopener ugc nofollow" target="_blank">日志查看器插件</a>。这个免费的插件给你两种方法来查看你的调试日志，以及清除它的能力。当这个插件被激活时，你可以从它的管理页面查看你的日志，这个页面可以从工具菜单里面进入。此外，如果你激活了<a class="ae la" href="https://wordpress.org/plugins/debug-bar/" rel="noopener ugc nofollow" target="_blank">调试栏插件</a>，这是WordPress最有用的开发工具之一，那么你可以从调试栏的面板上查看你的日志。我不建议在实时网站上激活调试栏，所以两个选项都有是很好的。这两个插件都可以从WordPress插件安装程序中安装，或者通过<a class="ae la" href="https://wordpress.org/plugins/developer/" rel="noopener ugc nofollow" target="_blank">开发者插件</a>安装，这个插件有很多有用的工具可以帮助你改进开发。</p><p id="7fd6" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">调试日志视图如下所示:</p><figure class="jq jr js jt fq ju fe ff paragraph-image"><div role="button" tabindex="0" class="lm ln di lo bf lp"><div class="fe ff ll"><img src="../Images/7b1795cc6175bf7866cfaed3c72ce0e8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*N3QJjO4c_Qb9XJh5.png"/></div></div></figure><p id="d90b" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">正如你所看到的，每次WordPress遇到一个警告或错误，或者生成一个通知，错误、警告或通知都会被写入日志，并带有一个UTC的时间戳。</p><h1 id="8b2c" class="jx jy hu bd jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku dt translated">将其他信息写入日志</h1><p id="229b" class="pw-post-body-paragraph ir is hu it b iu kv iw ix iy kw ja jb jc kx je jf jg ky ji jj jk kz jm jn jo hn dt translated">在某些情况下，您可能希望将信息写入日志，即使这在技术上不是错误。PHP有一个名为error_log的函数，它会将信息打印到错误日志中。默认情况下，它不会正确打印和格式化。出于这个原因，我建议为您的站点添加一个额外的函数来处理格式。它是error_log的包装器，使用print_r()在记录数组和对象之前对它们进行适当的格式化。该函数如下所示:</p><pre class="jq jr js jt fq lb lc ld le aw lf dt"><span id="326f" class="lg jy hu lc b fv lh li l lj lk">if ( ! function_exists('write_log')) {<br/>   function write_log ( $log )  {<br/>      if ( is_array( $log ) || is_object( $log ) ) {<br/>         error_log( print_r( $log, true ) );<br/>      } else {<br/>         error_log( $log );<br/>      }<br/>   }<br/>}</span></pre><p id="28b0" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">我强烈建议不要将这个添加到你的主题的functions.php中，因为在这种情况下，如果你采取普通的调试步骤切换到默认主题，它将不再工作。相反，为这个功能创建一个插件。这样做只需要在你的插件目录下创建一个文件，添加一个插件头和这个函数。标题可以像这样简单:</p><pre class="jq jr js jt fq lb lc ld le aw lf dt"><span id="fe10" class="lg jy hu lc b fv lh li l lj lk">/*<br/>Plugin Name: Log Error<br/>*/</span></pre><p id="4af1" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">一旦你有了这个功能，它就有了多种用途。想知道某一行代码是否被调用过？使用:</p><pre class="jq jr js jt fq lb lc ld le aw lf dt"><span id="a98c" class="lg jy hu lc b fv lh li l lj lk">write_log( __LINE__ );</span></pre><p id="570d" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">你甚至可以用它来收集关于你的网站的基本情报。例如，想要记录特定帖子何时被查看以及查看的用户是否登录？下面是一些简单的代码:</p><pre class="jq jr js jt fq lb lc ld le aw lf dt"><span id="d329" class="lg jy hu lc b fv lh li l lj lk">add_action( 'wp_head', 'slug_log_post_view' );<br/>function slug_log_post_view() {<br/>   //set the ID of the post you want to track here:<br/>   $post_to_track = 42;<br/> <br/>   //get the current post's ID &amp; make sure it's a valid ID and it matches our ID<br/>   $id = get_queried_object_id();<br/>   if ( intval( $id ) &gt; 0 &amp;&amp; $post_to_track === $id ) {<br/> <br/>      //check if current user is logged in and if so get the user ID<br/>      if ( is_user_logged_in() ) {<br/>         $user_id = get_current_user_id();<br/>         $user_id = 'a user with the ID ' . $user_id;<br/>      }<br/>      else{<br/>         $user_id = 'a user that was not logged in.';<br/>      }<br/> <br/>      //log the information<br/>      write_log( "The post {$post_to_track} was accessed by {$user_id}" );<br/> <br/>   }<br/> <br/>}</span></pre><p id="8154" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">虽然这个功能不是谷歌分析，但它确实提供了一种快速而肮脏的方式来收集特定帖子的情报。确保在变量$post_to_track中设置正确的文章ID。您甚至可以为所有帖子启用此功能，方法是取消检查以查看$post_to_track是否等于$id。如果是这样，请确保将最后一行改为使用$id，而不是$post_to_track。</p><h1 id="b070" class="jx jy hu bd jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku dt translated">所有的孩子都喜欢原木</h1><p id="c1ea" class="pw-post-body-paragraph ir is hu it b iu kv iw ix iy kw ja jb jc kx je jf jg ky ji jj jk kz jm jn jo hn dt translated">我希望这篇关于WordPress错误日志的介绍已经向你展示了如何使用WordPress的这个经常被忽视的功能来帮助你调试你的站点上的任何问题。不要忘记PHP错误并不是您可能产生的唯一错误类型。还有JavaScript错误，这些错误会显示在浏览器的JavaScript控制台中。</p></div></div>    
</body>
</html>